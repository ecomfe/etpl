<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>Examples - ETpl - Enterprise Template</title>
    <link rel="stylesheet" href="css/font-awesome.css" />
    <link rel="stylesheet" href="css/codemirror.css" />
    <link rel="stylesheet" href="css/neo.css" />
    <link rel="stylesheet" href="css/page.css" />
    <script src="js/example-code.js"></script>
</head>

<body>
    <header><div class="header-inner">
        <a href="index.html" class="logo"><img src="img/logo.png" width="50" height="50" alt="logo" /></a>
        <h1><a href="index.html">ETPL</a></h1>
        <nav>
            <a target="_blank" href="https://github.com/ecomfe/etpl/doc/"><i class="fa fa-book"></i>文档</a>
            <a target="_blank" href="https://github.com/ecomfe/etpl/archive/3.0.0.zip"><i class="fa fa-download"></i>下载</a>
            <a href="feature.html"><i class="fa fa-info-circle"></i>特点</a>
            <a href="example.html"><i class="fa fa-pencil-square" target="_blank"></i>示例</a>
            <a target="_blank" href="https://github.com/ecomfe/etpl"><i class="fa fa-github"></i>GitHub</a>
        </nav>
    </div></header>

    <div class="try-panel">
        <ul class="try-nav" id="try-nav">
        <script>
        (function () {
            for (var i = 0, l = EXAMPLE_CODE_NAV.length; i < l; i++) {
                var item = EXAMPLE_CODE_NAV[i];
                document.write('<li data-nav="' + item.example + '">' + item.title + '</li>');
            }
        })();
        </script>
        </ul>

        <div class="try-template">
            <h3>Template</h3>
            <textarea id="text-template"></textarea>
        </div>

        <div class="try-data">
            <h3>Data</h3>
            <textarea id="text-data"></textarea>
        </div>

        <b class="try-render" id="try-render">Render</b>

        <div class="try-config" id="try-config">
            <h3>Config</h3>
            <label>commandOpen</label>
            <input type="text" id="option-commandOpen" />
            <label>commandClose</label>
            <input type="text" id="option-commandClose" />
            <label>commandSyntax</label>
            <input type="text" id="option-commandSyntax" data-type="regexp" />
            <label>variableOpen</label>
            <input type="text" id="option-variableOpen" />
            <label>variableClose</label>
            <input type="text" id="option-variableClose" />
            <label>defaultFilter</label>
            <input type="text" id="option-defaultFilter" />
            <label>strip <input type="checkbox" id="option-strip"><label>
        </div>

        <div class="try-result">
            <h3>Result</h3>
            <textarea id="text-result" disabled="1"></textarea>
            <p><i class="fa fa-info-circle"></i> 为了方便功能演示，该页面为ETpl注册了markdown和slice两个filters。ETpl默认并不包含这些功能。</p>
        </div>
    </div>

    <div class="copyright">&copy;2014 <a href="http://www.baidu.com/">Baidu</a> <a href="http://efe.baidu.com/">EFE</a></div>

    <script src="js/etpl.js"></script>
    <script src="js/markdown.js"></script>
    <script src="js/codemirror.js"></script>
    <script src="js/codemirror-js.js"></script>
    <script src="js/codemirror-xml.js"></script>
    <script>
    (function () {
        var tplEditor = CodeMirror.fromTextArea(document.getElementById('text-template'), {
            mode: "text/html",
            theme: 'neo',
            indentUnit: 4,
            lineNumbers: true
        });
        tplEditor.setSize(790, 300);

        var dataEditor = CodeMirror.fromTextArea(document.getElementById('text-data'), {
            mode: "text/javascript",
            theme: 'neo',
            indentUnit: 4,
            lineNumbers: true
        });
        dataEditor.setSize(790, 200);

        var resultEditor = CodeMirror.fromTextArea(document.getElementById('text-result'), {
            mode: "text/html",
            theme: 'neo',
            indentUnit: 4,
            readOnly: true
        });
        resultEditor.setSize(790, 200);

        function getConfigInputs() {
            return document.getElementById('try-config').getElementsByTagName('input');
        }

        function render() {
            var tpl = tplEditor.doc.getValue();
            var data = dataEditor.doc.getValue();

            var options = {};
            var inputs = getConfigInputs();
            var len = inputs.length;
            while (len--) {
                var input = inputs[len];
                var optionName = input.id.replace('option-', '');
                switch (input.getAttribute('type')) {
                    case 'text':
                        if (input.getAttribute('data-type') === 'regexp') {
                            options[optionName] = new RegExp(input.value, 'i');
                        }
                        else {
                            options[optionName] = input.value;
                        }
                        break;

                    case 'checkbox':
                        options[optionName] = input.checked;
                        break;
                }
            }

            var result = '';
            var engine = new etpl.Engine(options);
            engine.addFilter('markdown', function (source) {
                return markdown.toHTML(source);
            });
            engine.addFilter('slice', function (source, start, end) {
                return source.slice(start, end)
            });
            var render;

            try {
                data = (new Function( 'return ' + data ))();
            }
            catch ( ex ) {
                result = 'invalid data';
            }

            try {
                render = engine.compile( tpl );
                if ( !render ) {
                    result = 'no template';
                }
            }
            catch ( ex ) {
                result = ex.message;
            }

            if ( result ) {
                resultEditor.doc.setValue(result);
                return;
            }

            try {
                result = render( data );
            }
            catch ( ex ) {
                result = ex.message;
            }
            resultEditor.doc.setValue(result);
        }

        function renderExample(type) {
            var example = EXAMPLE_CODE[type];

            if (example) {
                tplEditor.doc.setValue(example.tpl);
                dataEditor.doc.setValue(example.data || EXAMPLE_DEFAULT_DATA);

                var options = example.options || EXAMPLE_DEFAULT_OPTIONS;
                var inputs = getConfigInputs();
                var len = inputs.length;
                while (len--) {
                    var input = inputs[len];
                    var optionName = input.id.replace('option-', '');

                    switch (input.getAttribute('type')) {
                        case 'text':
                            input.value = options[optionName] || '';
                            break;

                        case 'checkbox':
                            input.checked = !!options[optionName];
                            break;
                    }
                }
            }

            render();
        }

        document.getElementById('try-nav').onclick = function (e) {
            e = e || window.event;
            var target = e.srcElement || e.target;

            if (target.tagName == 'LI') {
                var type = target.getAttribute('data-nav');
                location.hash = '#' + type;
                renderExample(type);
            }
        };

        document.getElementById('try-render').onclick = render;

        var startType = location.hash.replace(/^#/, '') || 'notarget';
        renderExample(startType);
    })();
    </script>
    
    <script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fab9cee8266375e25fe7635cc3f2a015c' type='text/javascript'%3E%3C/script%3E"));
</script>

</body>
</html>